// Generated by CoffeeScript 1.12.7
(function() {
  var $, AJAXWorkersManager;

  $ = jQuery;

  AJAXWorkersManager = (function() {
    var appendElementToDOM, shownFirstWorkersId;

    function AJAXWorkersManager() {}

    shownFirstWorkersId = {};

    AJAXWorkersManager.prototype.getWorkersBoss = function(bossId, count) {

      /* Get subordinates boss */
      var request;
      request = $.ajax({
        url: "/workers/",
        type: "GET",
        data: {
          boss: bossId,
          count: count,
          unnecessaryId: encodeURI(Object.keys(shownFirstWorkersId).join())
        },
        async: false
      });
      if (bossId === "first-hierarchy") {
        request.done(function(data, textStatus, jqXHR) {
          var element, i, len, results;
          if (data.length === 0 || data.length < count) {
            $('.load-more-workers').css({
              display: 'none'
            });
          }
          results = [];
          for (i = 0, len = data.length; i < len; i++) {
            element = data[i];
            if (!shownFirstWorkersId[element.id]) {
              shownFirstWorkersId[element.id] = {};
              results.push($('.container-workers').append(appendElementToDOM(element)));
            } else {
              results.push(void 0);
            }
          }
          return results;
        });
      } else {
        request.done(function(data, textStatus, jqXHR) {
          var element, i, len, results;
          results = [];
          for (i = 0, len = data.length; i < len; i++) {
            element = data[i];
            if (!shownFirstWorkersId[element.chief][element.id]) {
              shownFirstWorkersId[element.chief][element.id] = element;
              results.push($("#employee-id-" + element.chief).append(appendElementToDOM(element)));
            } else {
              results.push(void 0);
            }
          }
          return results;
        });
      }
      return request.fail(this.AJAXerrorGetWorkers);
    };

    AJAXWorkersManager.prototype.AJAXerrorGetWorkers = function(jqXHR, textStatus, errorThrown) {
      return console.log("Error: " + jqXHR + ", " + textStatus + ", " + errorThrown);
    };

    appendElementToDOM = function(element) {
      var element_chief, html;
      element_chief = element.chief ? element.chief : '';
      return html = "<div class=\"employee\" id=\"employee-id-" + element.id + "\">\n    <div class=\"row\">\n        <div class=\"col-md-3\"><img src=\"https://avatars0.githubusercontent.com/u/31619203?s=40&amp;v=4\" alt=\"Logo\" width=\"50\" height=\"50\" class=\"img-circle\"/></div>\n        <div class=\"col-md-3\">\n          <p>" + element.name + "</p>\n        </div>\n        <div class=\"col-md-3\">\n          <p>" + element.work_position + "</p>\n        </div>\n        <div class=\"col-md-3\">\n          <p>" + element_chief + "</p>\n        </div>\n    </div>\n</div>";
    };

    AJAXWorkersManager.prototype.showFirstHierarchy = function(count) {
      if (count == null) {
        count = 50;
      }

      /* Display list first hierarchy */
      return this.getWorkersBoss("first-hierarchy", count);
    };

    AJAXWorkersManager.prototype.showWorkersSecondHierarchy = function(count) {
      if (count == null) {
        count = 50;
      }

      /* Show 2 hierarchy workers */
      return this.getWorkersBoss("second-hierarchy", count);
    };

    AJAXWorkersManager.prototype.showListWorkers = function() {
      return console.log(shownFirstWorkersId);
    };

    return AJAXWorkersManager;

  })();

  $(document).ready(function() {
    var me2;
    me2 = new AJAXWorkersManager;
    me2.showFirstHierarchy(40);
    me2.showListWorkers();
    me2.showWorkersSecondHierarchy();
    return $(".load-more-workers").click(function() {
      me2.showFirstHierarchy(40);
      return me2.showWorkersSecondHierarchy();
    });
  });

}).call(this);
